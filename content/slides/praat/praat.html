<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to Praat and Praat Scripting</title>
    <meta charset="utf-8" />
    <meta name="author" content="-  Chenzi Xu" />
    <script src="praat_files/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introduction to Praat and Praat Scripting
## Lab Skillz Workshop
### -<svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"> <path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg> <a href="https://chenzixu.rbind.io/">Chenzi Xu</a>
### 2021/12/30 (updated: 2022-01-02)

---






# Our Goal

.left-column[
### First

### Second

### Third
]

.right-column[
.big[To know a full range of functions Praat can perform

To master how to navigate and use Praat's GUI

To learn scripting basics, parse praat script, and **start** praat scripting]

]

---
## Outline
.right-column[
1. ### [Why Praat?](#why)

1. ### [What is Praat capable of?](#functions)

1. ### [Praat scripting](#script)

1. ### [Demo and Practice](#demo)

]

---
class: inverse center middle

# Why Praat? ![Praat Icon](icon.png)

---

name: why

## Why Praat?

- Open source, free of charge

- Available for major computer platforms (MacOS, Windows, Linux) and systems

- Graphical User Interface

- A macro recording mechanism (Command History)

- You can create your own Praat scripts to **automate** things! 
  - Recurring tasks become less tedious and more efficient.
  - Consistent and Replicable measurement
  - Minimise human error

- You can create your own application with an autonomous GUI.
  - Python-praat package: [Parselmouth](https://parselmouth.readthedocs.io/en/stable/)
  - R-praat package: [rPraat](https://fu.ff.cuni.cz/praat/rDemo.html)


---
name: functions
class: inverse center middle

# What is Praat capable of?

--
**Creating and manipulating sounds**

**Visualizing and annotating sounds**

**Phonetic measurement and analysis**

**Creating publication-quality plots**

**Conducting phonetic experiment**

---
name: chart
background-image: url('praat.png')
background-size: cover
background-position: middle right


---

## Are you familiar with these tasks?

- Loading files

- Managing objects (create, copy, rename, save, remove)

- View objects and analyses

- Setting analysis parameters

- Querying objects (using buttons or menu commands)

- TextGrid annotation

---

## What does Praat contain?
.pull-l[
###Praat Objects
- Sound
- TextGrid
- Spectrogram
- Pitch, PitchTier
- Intensity, IntensityTier
- ExperimentMFC
- ...
]

.pull-m[
###Praat Editors
- SoundEditor
- TextGridEditor
- PitchEditor
- PointEditor
- SpectrumEditor
- ...
]

.pull-r[
###Praat Commands
- To Intensity...
- To TextGrid...
- Zoom in
- Get Minimum
- Convert to mono
- ...
]

.footnote[You must select the correct object/environment to issue the right commands!]
---
name: script
class: inverse center middle

# Praat Script

--
**String and numeric variables**

**For loops, if else statements, while loops**

**Regular expression matching**

**Comments**

**Syntax**

--

### OR ...

---
background-image: url('pitch1.png')
background-size: 32% 56%
background-position: 10% 90%
## Scripting Hacks I
### Check GUI for Syntax

.pull-right[
![Arguments for "To Pitch"](pitch2.png)


```r
*To Pitch: 0.0, 75.0, 600.0
```

]

---
## Scripting Hacks II
### Macro Recording Workflow (Command History)

```
1. New Praat Script
2. Edit &gt; Clear history (script editor)
3. GUI actions
4. Edit &gt; Paste history (script editor)
```

---
background-image: url('save.png')
background-size: 40% 70%
background-position: 90% 80%

## Scripting Hacks III
### Parse others' script and adapt

.pull-left[

- Parse the script in chunks and see if they suit your needs. Sometimes no need to reinvent the wheels.

- Learn from others' script.

&gt; Be cautious when using others'script. The syntax of Praat was updated since 2014.

&gt; **Test** it out first and remember to **cite** it!
&gt;
&gt; **Save frequently!**

]

---
## Scripting Hacks IV
.left-column[
### Boilerplate code

Place all paths, input/output files, and global variables at the top

Paths must end with a backslash /

Paths can be **relative** or **absolute**
]
.right-column[

```r
*dir$ = "/Users/Chenzi/mydir/data/"

Create Strings as file list: "file_list", dir$ + "*.wav"
nFiles = Get number of strings

for i from 1 to nFiles
    selectObject: "Strings file_list"
    filename$ = Get string: i
    basename$ = filename$ - ".wav"
    Read from file: dir$ + filename$
    
    ########################
    #### MORE CODE HERE ####
    ########################
    
endfor
```
]
---
## Scripting Hacks IV
.left-column[
### Boilerplate code
Create list of all .wav files in the directory and save the number to a variable

String variable ends in **`$`**; strings wrapped in **`""`**

Assignment operator **`=`**
]
.right-column[

```r
dir$ = "/Users/Chenzi/mydir/data/" 

*Create Strings as file list: "file_list", dir$ + "*.wav"
*nFiles = Get number of strings

for i from 1 to nFiles
    selectObject: "Strings file_list"
    filename$ = Get string: i
    basename$ = filename$ - ".wav"
    Read from file: dir$ + filename$
    
    ########################
    #### MORE CODE HERE ####
    ########################
    
endfor
```
]

---
## Scripting Hacks IV
.left-column[
### Boilerplate code
Set up a for loop to iterate over all files on the list

`1` is the starting point. It `+1` each time through the loop
]
.right-column[

```r
dir$ = "/Users/Chenzi/mydir/data/" 

Create Strings as file list: "file_list", dir$ + "*.wav"
nFiles = Get number of strings

*for i from 1 to nFiles
    selectObject: "Strings file_list"
    filename$ = Get string: i
    basename$ = filename$ - ".wav"
    Read from file: dir$ + filename$
    
    ########################
    #### MORE CODE HERE ####
    ########################
    
*endfor
```
]


---
## Scripting Hacks IV
.left-column[
### Boilerplate code
Read in each .wav file.

`Get string` : get the nth row of the list of filenames

]
.right-column[

```r
dir$ = "/Users/Chenzi/mydir/data/" 

Create Strings as file list: "file_list", dir$ + "*.wav"
nFiles = Get number of strings

for i from 1 to nFiles
*   selectObject: "Strings file_list"
*   filename$ = Get string: i
*   basename$ = filename$ - ".wav"
*   Read from file: dir$ + filename$
    
    ########################
    #### MORE CODE HERE ####
    ########################
    
endfor
```
]

---
name: demo
class: inverse center middle

# Demo and Practice
Task 1: Get total duration of all .wav files

Task 2*: Measure f0 in specified interval

---
# Task 1
.pull-left[ ###Basics
1.1 Get the number of .wav files in a directory

1.2 Get duration of each .wav file

1.3 Get total duration of all .wav files

1.4 Print results in Praat Info window
]
.pull-right[ ###Level up
1.5 Toggle option to "clean up" as you go

1.6 Add a user input form

1.7 Write results to a Text file]

.footnote[Adapted from Thea Knowles's Praat Tutorial]
---
### Step 1: How to get duration of one .wav file?
1. Open one .wav file in Praat **`Open &gt; Read from file`**
1. Select the Sound object, click **`Query &gt; Query time domain &gt; Get total duration`**

![:scale 50%](duration.png)

&gt; Avoid using `.` in the filename (except in the file extension)

---
### Step 2: Print command history

.pull-left[
1. At menu bar, **`Praat &gt; New Praat script`**
1. In the script editor, click **`Edit &gt; Paste history`**
1. **`File &gt; Save`**, type `"test.praat"`, and **`Run`**

![:scale 120%](history.png)
]

.pull-right[
&gt; #### Limitations: 
&gt;
&gt; Query commands may behave differently in scripts than in the GUI (Praat scripting assumes that you want to handle the query result inside the script)
&gt;
&gt; Changing scripting environments is not recorded

]

---
### Step 3: Loop over all .wav files
.left-column[ ### Update the boilerplate code

#### Any problems?
]
.right-column[

```r
dir$ = "data/" 

Create Strings as file list: "file_list", dir$ + "*.wav"
nFiles = Get number of strings

for i from 1 to nFiles
    selectObject: "Strings file_list"
    filename$ = Get string: i
    basename$ = filename$ - ".wav"
    Read from file: dir$ + filename$
    
*   selectObject: "Sound 'basename$'"
*   Get total duration
    
endfor
```
]

---
### Step 4: Manage output
.left-column[ ### Print out result
**`printline`** prints the argument to the Praat Info window

Contents of a variable enclosed in **`''`** 

Numeric variable doesn't end in **`$`**


]
.right-column[

```r
dir$ = "data/" 

Create Strings as file list: "file_list", dir$ + "*.wav"
nFiles = Get number of strings
*printline 'nFiles'

for i from 1 to nFiles
    selectObject: "Strings file_list"
    filename$ = Get string: i
    basename$ = filename$ - ".wav"
    Read from file: dir$ + filename$
*   printline 'basename$'
    selectObject: "Sound 'basename$'"
*   dur = Get total duration
*   printline 'dur'
    
endfor
```
]

---
### Step 5: Calculation in a for loop
.left-column[ ### Sum
Set up a dummy numeric variable **`total_dur`** and update its value through each loop

Numeric variables must start with a lower case letter, and be only letters, digits, and underscores

**`:4`**: print with 4 decimal places

]
.right-column[

```r
dir$ = "data/" 
Create Strings as file list: "file_list", dir$ + "*.wav"
nFiles = Get number of strings
*total_dur = 0

for i from 1 to nFiles
    selectObject: "Strings file_list"
    filename$ = Get string: i
    basename$ = filename$ - ".wav"
    Read from file: dir$ + filename$
    printline 'basename$'
    selectObject: "Sound 'basename$'"
    dur = Get total duration
    printline 'dur' 
*   total_dur = total_dur + dur
    
endfor
*printline 'total_dur:4'
```
]

---
### Level up (optional)
.left-col[ ### Clean up
There are different methods.

Sometimes leaving objects helps debugging.
]
.right-col[

```r
*clearinfo

for i from 1 to nFiles

    #### MORE CODE HERE ####
    
*   select all
*   minus Strings file_list
*   Remove
endfor

*select all
*Remove
*printline All finished!
```
]

---
### Level up (optional)
.footnote[More info at [Praat manual](https://www.fon.hum.uva.nl/praat/manual/Scripting_6_1__Arguments_to_the_script.html) and [Phonetics on Speed](https://praatscripting.lingphon.net/simpleinput-1.html)]
.left-col[ ### User Input form
Input forms are composed of fields, one per line.
User provides arguments to the script.

Input form code blocks are always processed first. 

You can't have two forms in one script.
]
.right-col[

```r
form Make selection
    comment Enter directory of files
    sentence Directory data/
    boolean Clean_up 1
endform

#### MORE CODE HERE ####
```

![:scale 60%](form.png)
]


---
### Level up (optional)

.left-col[ ### Toggle option
Create Boolean variable (TURE/FALSE or 1/0)

Nest it in a if statement.

]
.right-col[

```r
for i from 1 to nFiles

    #### MORE CODE HERE ####
*   if clean_up == 1
        select all
        minus Strings file_list
        Remove
*   endif
endfor

*if clean_up == 1
    select all
    Remove
*endif
printline All finished! 
```
]
---
### Level up (optional)

.left-col[ ### Write output
If you write a file to a path that already exists, it will be overwritten, and with **NO UNDO**.
 
Check if the file exists and ask permission before overwriting it.

![Warning message](warning.png)

]
.right-col[

```r
nFiles = Get number of strings
outFile$ = "duration.txt"
*askBeforeDelete = 1
*if askBeforeDelete and fileReadable(outFile$)
*   pauseScript: "File exists! Overwrite?"
*endif
*deleteFile: outFile$

for i from 1 to nFiles
    selectObject: "Strings file_list"
    filename$ = Get string: i
    basename$ = filename$ - ".wav"
    Read from file: dir$ + filename$
    selectObject: "Sound 'basename$'"
    dur = Get total duration
*   appendInfoLine: basename$, " ", dur
*   appendFileLine: outFile$, basename$, " ", dur
endfor
```
]
---
# Task 2
.pull-left[ ###Basics
1.1 Get the number of .wav files in a directory

1.2 Get pitch/f0 track of each .wav file

1.3 Print results in Praat Info window
]
.pull-right[ ###Level up
1.5 Add a user input form to specify starting and ending times

1.6 Toggle option to "clean up" as you go

1.7 Save f0 results of all .wav files to a text file
]
### Could you do it yourself now?
---

## Online resources

&gt; Always check: [Praat Manual](https://www.fon.hum.uva.nl/praat/manual/Intro.html)!

#### References and good resources:

If you want to have more solid understanding and more practices, check out:

[Phonetics on Speed: Praat Scripting Tutorial](https://praatscripting.lingphon.net/)

If you would like to learn more about Praat script basics, check out:
[Praat Scripting Tutorial by Eleanor Chodroff](https://www.eleanorchodroff.com/tutorial/PraatScripting.pdf)

Recorded tutorial about Praat script by CASA Lab:
[Praat Scripting Tutorial by CASA Lab, University at Buffalo](https://bookdown.org/thea_knowles/casa_coding_group/spring-2020.html)
---
class: center, middle

# Thanks!

Slides created via the R packages:

[**xaringan**](https://github.com/yihui/xaringan)&lt;br&gt;
[gadenbuie/xaringanthemer](https://github.com/gadenbuie/xaringanthemer)

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](http://yihui.name/knitr), and [R Markdown](https://rmarkdown.rstudio.com).

Theme design ideas from [Katie Jolly](https://www.katiejolly.io/blog/2021-03-16/designing-slides).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
